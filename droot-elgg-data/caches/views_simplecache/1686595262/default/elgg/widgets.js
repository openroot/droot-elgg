define("elgg/widgets",['elgg','jquery','elgg/ready'],function(elgg,$){var widgets={};widgets.init=function(){if($(".elgg-widgets").length===0){return;}
$(".elgg-widgets").sortable({items:'div.elgg-module-widget.elgg-state-draggable',connectWith:'.elgg-widgets',handle:'.elgg-widget-handle',forcePlaceholderSize:true,placeholder:'elgg-widget-placeholder',opacity:0.8,revert:500,stop:widgets.move});$(document).on('click','a.elgg-widget-delete-button',widgets.remove);$(document).on('submit','.elgg-widget-edit > form ',widgets.saveSettings);$(document).on('click','a.elgg-widget-collapse-button',widgets.collapseToggle);};widgets.move=function(event,ui){var guidString=ui.item.attr('id');guidString=guidString.substr(guidString.indexOf('elgg-widget-')+"elgg-widget-".length);var col=ui.item.parent().attr('id');col=col.substr(col.indexOf('elgg-widget-col-')+"elgg-widget-col-".length);elgg.action('widgets/move',{data:{widget_guid:guidString,column:col,position:ui.item.index()}});ui.item.css('top',0);ui.item.css('left',0);};widgets.remove=function(event){if(confirm(elgg.echo('deleteconfirm'))===false){event.preventDefault();return;}
$(this).closest('.elgg-module-widget').remove();elgg.action($(this).attr('href'));event.preventDefault();};widgets.collapseToggle=function(event){$(this).toggleClass('elgg-widget-collapsed');$(this).parent().parent().find('.elgg-body').slideToggle('medium');event.preventDefault();};widgets.saveSettings=function(event){$(this).parent().slideToggle('medium');var $widgetContent=$(this).parent().parent().children('.elgg-widget-content');var $loader=$('#elgg-widget-loader').clone();$loader.attr('id','#elgg-widget-active-loader');$loader.removeClass('hidden');$widgetContent.html($loader);elgg.action('widgets/save',{data:$(this).serialize(),success:function(json){$widgetContent.html(json.output.content);if(typeof(json.output.title)!="undefined"){var $widgetTitle=$widgetContent.parent().parent().find('.elgg-widget-title');var newWidgetTitle=json.output.title;if(typeof(json.output.href)!="undefined"){newWidgetTitle="<a href='"+json.output.href+"' class='elgg-anchor'><span class='elgg-anchor-label'>"+newWidgetTitle+"</span></a>";}
$widgetTitle.html(newWidgetTitle);}}});event.preventDefault();};return widgets;});